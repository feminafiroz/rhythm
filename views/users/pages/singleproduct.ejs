<div class="breadcrumb-area" style="background-color: black; color: white;">
    <div class="container">
        <div class="breadcrumb-content text-center pt-1">
            <ul>
                <li>
                    <h3 style="color: white;"><a href="/" >Home</a></h3>
                </li>
                <li>
                    <h3 style="color: white;">/</h3>
                </li>
                <li>
                    <h3 style="color: white;">Product</h3>
                </li>
            </ul>
        </div>
    </div>
</div>

<div class="product-details ptb-100 pb-90">
    <div class="container">
        <div class="row">
            <div class="col-md-12 col-lg-7 col-12">

                <!-- Inside the HTML template -->
                <div class="product-details-img-content">
                    <div class="product-details-tab mr-35 product-details-tab2">
                        <div class="product-details-small nav mr-10 product-details-2" role="tablist">

                            <!-- side Images -->
                            <% if (Array.isArray(product.images) && product.images.length> 0) { %>
                                <% product.images.forEach((image, index)=> { %>
                                    <a class="<%= index === 0 ? 'active' : '' %> mb-10"
                                        href="#pro-details<%= index + 1 %>" data-bs-toggle="tab" role="tab"
                                        aria-selected="<%= index === 0 %>">
                                        <img src="<%= image.thumbnailUrl %>" alt="">
                                    </a>
                                    <% }); %>
                                        <% } %>

                                            
                        </div>

                        <div class="product-details-large tab-content">
                            <!-- Large image content -->
                            <% if (Array.isArray(product.images) && product.images.length> 0) { %>
                                <% product.images.forEach((image, index)=> { %>
                                    <div class="tab-pane <%= index === 0 ? 'active show' : '' %> fade"
                                        id="pro-details<%= index + 1 %>" role="tabpanel">
                                        <div class="easyzoom easyzoom--overlay is-ready">
                                            <a href="<%= image.imageUrl %>">
                                                <img src="<%= image.imageUrl %>" alt="">
                                            </a>
                                        </div>
                                    </div>
                                    <% }); %>
                                        <% } %>

                                  
                        </div>
                    </div>
                </div>

            </div>
            <div class="col-md-12 col-lg-5 col-12">
                <div class="product-details-content">
                    <h3>
                        <%= product.title %>
                    </h3>
                    

                    <div class="rating-number">
                        <div class="quick-view-rating">
                            <div class="quick-view-rating d-flex justify-content-between">
                                <img src="/admin/assets/imgs/icons/star.svg" style="height: 40px; width: 40px" alt="star" />
                                <span class="text-secondary"><%= `(${avgRating})` %></span>
                            </div>
                        </div>
                        <div class="quick-view-number">
                            <span><%= reviews.length %> Ratings</span>
                        </div>
                    </div>



                    <span class="text-decoration-line-through">
                        ₹<%= (product.productPrice).toLocaleString() %></span>
                    <div class="details-price">
                        <span>₹<%= (product.salePrice).toLocaleString() %></span>
                    </div>
                    <div class="stock mb-3 text-warning">
                        <% if (product.quantity < 5 && product.quantity>1) { %>
                            <span>
                                Hurry Only <%= product.quantity%> left!
                            </span>
                            <% }%>
                    </div>

                   
                    <div class="quickview-plus-minus">
                        <div class="product-list-cart">
                            <% if (!user) { %>
                                <a class="btn-hover list-btn-style" href="/login">Add to
                                    Cart</a>
                                <% }else { %>
                            
                                <!-- <a class="btn-hover list-btn-style" href="/add/<%= product._id %>">Add
                                    to
                                    Cart</a> -->

                                    <a class="btn-hover list-btn-style"  title="Add To Cart" onclick="addToCart(`<%= product._id %>`)">Add
                                        to
                                        Cart</a>
                                
                                        <% } %>
                        </div>
                        <!-- <div class="quickview-btn-wishlist">
                            <a class="btn-hover" href="#"><i class="pe-7s-like"></i></a>
                        </div> -->
                        <div class="quickview-btn-wishlist">
                        <% if (!user) { %>

                            <a class=" btn-hover animate-left" title="Wishlist"
                                href="/login">
                                <i class="pe-7s-like"></i>
                            </a>
                            <% }else { %>
                                <% if (userWishlist) { %>
                                    <a class=" btn-hover animate-left"
                                        id="wishlist" href=""
                                        onclick="addTowishlist(`<%= product._id %>`)">

                                            <% if (userWishlist.includes(product._id))
                                            { %>
                                            <i class="pe-7s-like"
                                                style="color: red;"></i>
                                            <% } else { %>
                                                <i
                                                    class="pe-7s-like"></i>
                                                <% } %>
                                    </a>
                                    <% } else { %>
                                        <a class="btn-hover  animate-left"
                                            href="/login"> <i
                                                class="pe-7s-like"></i></a>
                                        <% } %>

                                <%}%>
                            </div>
                    </div>
                    <div class="product-details-cati-tag mt-35">
                        <ul>
                            <li class="categories-title">Category :</li>
                            <li><a href="#">
                                    <%= product.categoryName.categoryName %>
                                </a></li>
                        </ul>
                    </div>
                    <br>
                    
                    <div class="product-share">
                        <ul>
                            <li class="categories-title">Share :</li>
                            <li>
                                <a href="#">
                                    <i class="icofont icofont-social-facebook"></i>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <i class="icofont icofont-social-twitter"></i>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <i class="icofont icofont-social-pinterest"></i>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <i class="icofont icofont-social-flikr"></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- EJS template -->
<div class="product-description-review-area pb-90">
    <div class="container">
        <div class="product-description-review text-center">
            <div class="description-review-title nav" role="tablist">
                <a class="active" href="#pro-dec" data-bs-toggle="tab" role="tab" aria-selected="true">
                    Description
                </a>
                <a href="#pro-review" data-bs-toggle="tab" role="tab" aria-selected="false">

                    Reviews (<%= reviews.length %> )
                </a>
            </div>
            <div class="description-review-text tab-content">
                <div class="tab-pane active show fade" id="pro-dec" role="tabpanel">
                    <% const sections=product.description.split('\n\n'); sections.forEach(section=> {
                        const lines = section.split('\n');
                        const title = lines[0];
                        const details = lines.slice(1);
                        %>
                        <div class="structured-section">
                           
                            <ul>
                                <li><%= title %></li>
                                <% details.forEach(detail=> { %>
                                    <li>
                                        <%= detail %>
                                    </li>
                                    <% }); %>
                            </ul>
                        </div>
                        <% }); %>
                </div>
                <!-- <div class="tab-pane fade" id="pro-review" role="tabpanel">
                    <a href="#">Be the first to write your review!</a>
                </div>
                 -->

                 <div class="tab-pane fade" id="pro-review" role="tabpanel">
                    <% if ( reviews.length <1) { %>
                    <!-- <p class="text-dark">No reviews</p> -->
                    <a href="#">Be the first to write your review!</a>
                    <% } else { %>
                    <div class="testimonials-area bg-img" style="background-image: url(/assets/img/instra/nyk20bg.jpg)">
                        <div class="container">
                            <div class="testimonials-active owl-carousel">
                                <% reviews.forEach(review => { %>
                                <div class="single-testimonial-2 text-center">
                                    <img style="width: 100px; height: 100px;" class="rounded-circle" src="<%=
                                    review?.user?.image || "/admin/assets/imgs/icons/user.png" %>" alt="user" />
                                    <p><%= review.review %></p>
                                    <h4>Posted By <%= review?.user?.userName %></h4>
                                    <span><%= review.rating %> Stars </span>
                                </div>
                                <% }) %>
                            </div>
                        </div>
                    </div>
                    <% } %>
                </div>

            </div>
        </div>
    </div>
</div>



<div class="product-area pb-95">
    <div class="container">
        <div class="section-title-3 text-center mb-50">
            <h2>Related products</h2>
        </div>
        <div class="row">
            <% if (products.length> 0) { %>
                <% products.forEach(element=> { %>
                    <div class="col-md-4">
                        <div class="card">
                            <% if (Array.isArray(element.images) && element.images.length> 0) { %>
                            <a href="/viewProduct/<%= element._id%>">
                                <img class="card-img-top img-size"
                                    src="<%= element.images[0].imageUrl %>"
                                    alt="<%= element?.title %>">
                            </a>
                            <% }%>
                            <div class="card-body">
                                <h5 class="card-title">
                                    <a href="/viewProduct/<%= element._id%>" class="truncate-text">
                                        <%= element?.title %>
                                    </a>
                                </h5>
                                <p class="card-text">₹<%= element?.salePrice %>
                                </p>
                                <div class="product-action">
                                    <a class="animate-left" title="Wishlist" href="/wishlist">
                                        <i class="pe-7s-like"></i>
                                    </a>
                                    <a class="animate-top" title="Add To Cart" href="#">
                                        <i class="pe-7s-cart"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <% }); %>
                        <% } %>
        </div>
    </div>
</div>




<style>
    .truncate-text {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 5em;
        /* Adjust the width as needed */
    }

    .card-title a {
        display: block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
        /* Adjust the width as needed */
    }

    .img-size {
        max-width: 300px;
        max-height: 300px;
    }

    /* CSS Styles */
    .structured-text {
        width: 100%;
        /* Set an appropriate width */
        white-space: pre-line;
        /* Preserve line breaks */
        line-height: 1.5;
        /* Adjust line spacing as needed */
        font-family: Arial, sans-serif;
        /* Choose a font */
        font-size: 14px;
        /* Adjust font size as needed */
        /* Add more styles as desired */
    }
</style>

<script src="/assets/js/shop/wishlist.js"></script>
<script src="/assets/js/shop/cart.js"></script>


